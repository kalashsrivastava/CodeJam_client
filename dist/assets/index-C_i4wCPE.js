import{j as n,r as i}from"./react-DGCpgZEe.js";import{a as ze}from"./react-dom-nyJOfMSm.js";import{B as He}from"./react-router-dom-hhRQcvtk.js";import{D as Ge,c as I,k as R}from"./react-hot-toast-B8i475Qd.js";import{l as We}from"./socket.io-client-CDVIIGn8.js";import{L as Ye,R as Je,a as Ve,b as Be,A as $e,c as qe,P as xe,M as we,T as Qe,B as Xe,d as Ee,e as Ne,I as Ke,G as Ze,f as et,g as tt,h as nt,i as st,j as rt,k as ot,l as it,m as at}from"./react-icons-v__Kpauw.js";import{v as H}from"./uuid-CtRu48qb.js";import{F as lt}from"./file-saver-fwyHJWpa.js";import{J as ct}from"./jszip-iD5t_2rG.js";import{I as ut}from"./vscode-icons-js-DjHKlEgo.js";import{I as be}from"./@iconify-BlKK0um_.js";import{c as Y}from"./classnames-D3e892sy.js";import{a as dt}from"./axios-DW_MHI2K.js";import{l as Ce}from"./lang-map-BDdiMAWE.js";import{x as mt,a as ft,w as pt,b as ht,v as gt,t as xt,c as wt,d as Et,e as Nt,s as bt,f as Ct,g as vt,r as yt,q as St,o as jt,n as Dt,h as It,m as Rt,i as kt,j as Lt,k as Tt,l as Ot,p as Ft,u as At,y as Pt,z as _t,A as Ut,B as Mt,C as zt,D as Ht,E as Gt,F as Wt,G as Yt,H as Jt,I as Vt,J as Bt,K as $t,L as qt,M as Qt,N as Xt,O as Kt,P as Zt,Q as en,R as tn,S as nn,T as sn,U as rn,V as on}from"./@uiw-fCc9OOPG.js";import{A as an}from"./react-avatar-C43C87zh.js";import{u as q,a as ln,b as ve,c as cn,d as de}from"./react-router-By44Q7IM.js";import{S as un}from"./react-split-CIPkPmSf.js";import"./core-js-CJ9Pyc3J.js";import{u as dn}from"./@tldraw-BnnMxjSL.js";import"./lodash.throttle-DhdlGi_f.js";import"./lodash.uniq-D-VRxY98.js";import"./lodash.isequal-CoyRWIZe.js";import"./idb-Bn1DMRyg.js";import{T as mn}from"./tldraw-ClME9FTe.js";import"./lz-string-CKR0mnt7.js";import"./hotkeys-js-CYfJsHie.js";import{E as fn,bV as pn,bW as hn,bX as gn}from"./@codemirror-CxzCVOab.js";import{s as me}from"./screenfull-DmVOzVZz.js";import"./charenc-CKB3dhLb.js";import"./scheduler-DYLXRpC5.js";import"./@remix-run-C821s7Ri.js";import"./goober-np-fLvOt.js";import"./engine.io-client-C44f3zIw.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./@babel-D-Vw05Li.js";import"./@lezer-BSHTcVQv.js";import"./codemirror-lang-mermaid-CizGaCsb.js";import"./@replit-BAZHVzUH.js";import"./@nextjournal-yXq-_VHt.js";import"./colors-named-CSGyx1iI.js";import"./colors-named-hex-Db6HdBCI.js";import"./hsl-matcher-CyxH9sTP.js";import"./core-js-pure-DCE-v8wG.js";import"./prop-types-BpeVGpEB.js";import"./is-retina-ZyRGC3SP.js";import"./md5-DReYsN2t.js";import"./crypt-cVg_o3mt.js";import"./is-buffer-DoLxFxiE.js";import"./split.js-CPyVEc61.js";import"./@use-gesture-CMpa_9u-.js";import"./eventemitter3-CpQ6oWTW.js";import"./@radix-ui-Dn6hvus2.js";import"./react-remove-scroll-BEb394xP.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-VWwLbvAf.js";import"./react-style-singleton-C8hQCxCO.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-hBrjkvOY.js";import"./use-callback-ref-DSvXtDbg.js";import"./aria-hidden-DQ5UC2Eg.js";import"./@floating-ui-D-XUU5vI.js";import"./canvas-size-BJ7hgjqk.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();function xn(){return n.jsx(Ge,{position:"top-right"})}var P=(e=>(e.CODING="coding",e.DRAWING="drawing",e))(P||{}),$=(e=>(e.OFFLINE="offline",e.ONLINE="online",e))($||{}),T=(e=>(e.INITIAL="initial",e.CONNECTING="connecting",e.ATTEMPTING_JOIN="attempting-join",e.JOINED="joined",e.CONNECTION_FAILED="connection-failed",e.DISCONNECTED="disconnected",e))(T||{});const ye=i.createContext(null),L=()=>{const e=i.useContext(ye);if(e===null)throw new Error("useAppContext must be used within a AppContextProvider");return e};function wn({children:e}){const[t,s]=i.useState([]),[r,o]=i.useState(T.INITIAL),[a,d]=i.useState({username:"",roomId:""}),[l,u]=i.useState(P.CODING),[c,p]=i.useState(null);return n.jsx(ye.Provider,{value:{users:t,setUsers:s,currentUser:a,setCurrentUser:d,status:r,setStatus:o,activityState:l,setActivityState:u,drawingData:c,setDrawingData:p},children:e})}var x=(e=>(e.JOIN_REQUEST="join-request",e.JOIN_ACCEPTED="join-accepted",e.USER_JOINED="user-joined",e.USER_DISCONNECTED="user-disconnected",e.SYNC_FILE_STRUCTURE="sync-file-structure",e.DIRECTORY_CREATED="directory-created",e.DIRECTORY_UPDATED="directory-updated",e.DIRECTORY_RENAMED="directory-renamed",e.DIRECTORY_DELETED="directory-deleted",e.FILE_CREATED="file-created",e.FILE_UPDATED="file-updated",e.FILE_RENAMED="file-renamed",e.FILE_DELETED="file-deleted",e.USER_OFFLINE="offline",e.USER_ONLINE="online",e.SEND_MESSAGE="send-message",e.RECEIVE_MESSAGE="receive-message",e.TYPING_START="typing-start",e.TYPING_PAUSE="typing-pause",e.USERNAME_EXISTS="username-exists",e.REQUEST_DRAWING="request-drawing",e.SYNC_DRAWING="sync-drawing",e.DRAWING_UPDATE="drawing-update",e))(x||{});const Se=i.createContext(null),F=()=>{const e=i.useContext(Se);if(!e)throw new Error("useSocket must be used within a SocketProvider");return e},En="https://codejam-server.onrender.com",Nn=({children:e})=>{const{users:t,setUsers:s,setStatus:r,setCurrentUser:o,drawingData:a,setDrawingData:d}=L(),l=i.useMemo(()=>We(En,{reconnectionAttempts:2}),[]),u=i.useCallback(f=>{console.log("socket error",f),r(T.CONNECTION_FAILED),I.dismiss(),I.error("Failed to connect to the server")},[r]),c=i.useCallback(()=>{I.dismiss(),r(T.INITIAL),I.error("The username you chose already exists in the room. Please choose a different username.")},[r]),p=i.useCallback(({user:f,users:v})=>{o(f),s(v),I.dismiss(),r(T.JOINED),v.length>1&&I.loading("Syncing data, please wait...")},[o,r,s]),y=i.useCallback(({user:f})=>{I.success(`${f.username} left the room`),s(t.filter(v=>v.username!==f.username))},[s,t]),N=i.useCallback(({socketId:f})=>{l.emit(x.SYNC_DRAWING,{socketId:f,drawingData:a})},[a,l]),h=i.useCallback(({drawingData:f})=>{d(f)},[d]);return i.useEffect(()=>(l.on("connect_error",u),l.on("connect_failed",u),l.on(x.USERNAME_EXISTS,c),l.on(x.JOIN_ACCEPTED,p),l.on(x.USER_DISCONNECTED,y),l.on(x.REQUEST_DRAWING,N),l.on(x.SYNC_DRAWING,h),()=>{l.off("connect_error"),l.off("connect_failed"),l.off(x.USERNAME_EXISTS),l.off(x.JOIN_ACCEPTED),l.off(x.USER_DISCONNECTED),l.off(x.REQUEST_DRAWING),l.off(x.SYNC_DRAWING)}),[h,u,p,N,y,c,s,l]),n.jsx(Se.Provider,{value:{socket:l},children:e})},je=i.createContext(null),ee=()=>{const e=i.useContext(je);if(!e)throw new Error("useChatRoom must be used within a ChatContextProvider");return e};function bn({children:e}){const{socket:t}=F(),[s,r]=i.useState([]),[o,a]=i.useState(!1),[d,l]=i.useState(0);return i.useEffect(()=>(t.on(x.RECEIVE_MESSAGE,({message:u})=>{r(c=>[...c,u]),a(!0)}),()=>{t.off(x.RECEIVE_MESSAGE)}),[t]),n.jsx(je.Provider,{value:{messages:s,setMessages:r,isNewMessage:o,setIsNewMessage:a,lastScrollHeight:d,setLastScrollHeight:l},children:e})}function Cn(e){const t=new Date(e);let s=t.getHours();const r=String(t.getMinutes()).padStart(2,"0"),o=s>=12?"PM":"AM";return s=s%12,s=s||12,`${s}:${r} ${o}`}function vn(){const{currentUser:e}=L(),{socket:t}=F(),{setMessages:s}=ee(),r=i.useRef(null),o=a=>{var l;a.preventDefault();const d=(l=r.current)==null?void 0:l.value.trim();if(d&&d.length>0){const u={id:H(),message:d,username:e.username,timestamp:Cn(new Date().toISOString())};t.emit(x.SEND_MESSAGE,{message:u}),s(c=>[...c,u]),r.current&&(r.current.value="")}};return n.jsxs("form",{onSubmit:o,className:"flex justify-between rounded-md border border-primary",children:[n.jsx("input",{type:"text",className:"w-full flex-grow rounded-md border-none bg-dark p-2 outline-none",placeholder:"Enter a message...",ref:r}),n.jsx("button",{className:"flex items-center justify-center rounded-r-md  bg-primary p-2 text-black",type:"submit",children:n.jsx(Ye,{size:24})})]})}function yn(){const{messages:e,isNewMessage:t,setIsNewMessage:s,lastScrollHeight:r,setLastScrollHeight:o}=ee(),{currentUser:a}=L(),d=i.useRef(null),l=u=>{const c=u.target;o(c.scrollTop)};return i.useEffect(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[e]),i.useEffect(()=>{t&&s(!1),d.current&&(d.current.scrollTop=r)},[t,s,r]),n.jsx("div",{className:"flex-grow overflow-auto rounded-md bg-darkHover p-2",ref:d,onScroll:l,children:e.map((u,c)=>n.jsxs("div",{className:"mb-2 w-[80%] self-end break-words rounded-md bg-dark px-3 py-2"+(u.username===a.username?" ml-auto ":""),children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-xs text-primary",children:u.username}),n.jsx("span",{className:"text-xs text-white",children:u.timestamp})]}),n.jsx("p",{className:"py-1",children:u.message})]},c))})}function J(){const[e,t]=i.useState({width:window.innerWidth,height:window.innerHeight}),[s,r]=i.useState(window.innerWidth<768);return i.useEffect(()=>{const o=()=>{t({width:window.innerWidth,height:window.innerHeight}),r(window.innerWidth<768)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]),{...e,isMobile:s}}function O(){const[e,t]=i.useState(!1),{height:s,isMobile:r}=J(),[o,a]=i.useState(s);return i.useEffect(()=>{s<500&&r?(t(!0),a(s)):r?(t(!1),a(s-50)):(t(!1),a(s))},[s,r,o]),{viewHeight:o,minHeightReached:e}}const Sn=()=>{const{viewHeight:e}=O();return n.jsxs("div",{className:"flex max-h-full min-h-[400px] w-full flex-col gap-2 p-4",style:{height:e},children:[n.jsx("h1",{className:"view-title",children:"Group Chat"}),n.jsx(yn,{}),n.jsx(vn,{})]})},jn=`function sayHi() {
  console.log("👋 Hello world");
}

sayHi()`,Dn={name:"root",id:H(),type:"directory",children:[{id:H(),type:"file",name:"index.js",content:jn}]},De=(e,t)=>{if(e.id===t&&e.type==="directory")return e;if(e.type==="directory"&&e.children)for(const s of e.children){const r=De(s,t);if(r)return r}return null},fe=(e,t)=>e.children?e.children.some(s=>s.name===t):!1,In=(e,t)=>{const s=r=>{if(r.id===t)return r;if(r.children)for(const o of r.children){const a=s(o);if(a)return a}return null};return s(e)},Ie=e=>{if(e.type==="directory"&&e.children){let t=e.children.filter(r=>r.type==="directory");const s=e.children.filter(r=>r.type==="file");t.sort((r,o)=>r.name.localeCompare(o.name)),t=t.map(r=>Ie(r)),s.sort((r,o)=>r.name.localeCompare(o.name)),e.children=[...t.filter(r=>r.name.startsWith(".")),...t.filter(r=>!r.name.startsWith(".")),...s.filter(r=>r.name.startsWith(".")),...s.filter(r=>!r.name.startsWith("."))]}return e},Re=i.createContext(null),_=()=>{const e=i.useContext(Re);if(!e)throw new Error("useFileSystem must be used within FileContextProvider");return e};function Rn({children:e}){const{socket:t}=F(),{setUsers:s,drawingData:r}=L(),[o,a]=i.useState(Dn),d=o.children?o.children:[],[l,u]=i.useState(d),[c,p]=i.useState(l[0]),y=m=>{const g=E=>E.id===m?{...E,isOpen:!E.isOpen}:E.children?{...E,children:E.children.map(g)}:E;a(E=>g(E))},N=()=>{const m=g=>{var E;return{...g,isOpen:!1,children:(E=g.children)==null?void 0:E.map(m)}};a(g=>m(g))},h=i.useCallback((m,g,E=!0)=>{let w;typeof g=="string"?w={id:H(),name:g,type:"directory",children:[],isOpen:!1}:w=g,m||(m=o.id);const b=C=>C.id===m?{...C,children:[...C.children||[],w]}:C.children?{...C,children:C.children.map(b)}:C;return a(C=>b(C)),E&&t.emit(x.DIRECTORY_CREATED,{parentDirId:m,newDirectory:w}),w.id},[o.id,t]),f=i.useCallback((m,g,E=!0)=>{m||(m=o.id);const w=b=>b.id===m?{...b,children:g}:b.children?{...b,children:b.children.map(w)}:b;a(b=>w(b)),u([]),p(null),m===o.id&&(I.dismiss(),I.success("Files and folders updated")),E&&t.emit(x.DIRECTORY_UPDATED,{dirId:m,children:g})},[o.id,t]),v=i.useCallback((m,g,E=!0)=>{const w=C=>C.type==="directory"&&C.children?C.children.some(S=>S.type==="directory"&&S.name===g&&S.id!==m)?null:{...C,children:C.children.map(S=>{if(S.id===m)return{...S,name:g};if(S.type==="directory"){const V=w(S);return V!==null?V:S}else return S})}:C,b=w(o);return b===null?!1:(a(b),E&&t.emit(x.DIRECTORY_RENAMED,{dirId:m,newDirName:g}),!0)},[t,a,o]),j=i.useCallback((m,g=!0)=>{const E=w=>{if(w.type==="directory"&&w.id===m)return null;if(w.children){const b=w.children.map(E).filter(C=>C!==null);return{...w,children:b}}else return w};a(w=>E(w)),g&&t.emit(x.DIRECTORY_DELETED,{dirId:m})},[t]),k=m=>{const g=In(o,m);g&&(M((c==null?void 0:c.id)||"",(c==null?void 0:c.content)||""),l.some(E=>E.id===m)||u(E=>[...E,g]),u(E=>E.map(w=>w.id===(c==null?void 0:c.id)?{...w,content:c.content||""}:w)),p(g))},U=m=>{if(m===(c==null?void 0:c.id)){M(c.id,c.content||"");const g=l.findIndex(E=>E.id===m);g!==-1&&l.length>1?g>0?p(l[g-1]):p(l[g+1]):p(null)}u(g=>g.filter(E=>E.id!==m))},A=i.useCallback((m,g,E=!0)=>{let w=1;m||(m=o.id);const b=De(o,m);if(!b)throw new Error("Parent directory not found");let C;if(typeof g=="string"){let S=g,V=fe(b,S);for(;V;)S=`${S.split(".")[0]}(${w}).${S.split(".")[1]}`,V=fe(b,S),w++;C={id:H(),name:S,type:"file",content:""}}else C=g;const K=S=>S.id===b.id?{...S,children:[...S.children||[],C],isOpen:!0}:S.children?{...S,children:S.children.map(K)}:S;return a(S=>K(S)),u(S=>[...S,C]),p(C),E&&t.emit(x.FILE_CREATED,{parentDirId:m,newFile:C}),C.id},[o,t]),M=i.useCallback((m,g)=>{const E=w=>w.type==="file"&&w.id===m?{...w,content:g}:w.children?{...w,children:w.children.map(E)}:w;a(w=>E(w)),l.some(w=>w.id===m)&&u(w=>w.map(b=>b.id===m?{...b,content:g}:b))},[l]),G=i.useCallback((m,g,E=!0)=>{const w=b=>b.type==="directory"&&b.children?{...b,children:b.children.map(C=>C.type==="file"&&C.id===m?{...C,name:g}:C)}:b;return a(b=>w(b)),u(b=>b.map(C=>C.id===m?{...C,name:g}:C)),m===(c==null?void 0:c.id)&&p(b=>b?{...b,name:g}:null),E&&t.emit(x.FILE_RENAMED,{fileId:m,newName:g}),!0},[c==null?void 0:c.id,t]),W=i.useCallback((m,g=!0)=>{const E=w=>{if(w.type==="directory"&&w.children){const b=w.children.map(C=>C.type==="directory"?E(C):C.id!==m?C:null).filter(C=>C!==null);return{...w,children:b}}else return w};a(w=>E(w)),l.some(w=>w.id===m)&&u(w=>w.filter(b=>b.id!==m)),(c==null?void 0:c.id)===m&&p(null),I.success("File deleted successfully"),g&&t.emit(x.FILE_DELETED,{fileId:m})},[c==null?void 0:c.id,l,t]),Me=()=>{const m=new ct,g=(E,w="")=>{const b=w+E.name+(E.type==="directory"?"/":"");if(E.type==="file")m.file(b,E.content||"");else if(E.type==="directory"&&E.children)for(const C of E.children)g(C,b)};if(o.type==="directory"&&o.children)for(const E of o.children)g(E);m.generateAsync({type:"blob"}).then(E=>{lt.saveAs(E,"download.zip")})},te=i.useCallback(({user:m})=>{I.success(`${m.username} joined the room`),t.emit(x.SYNC_FILE_STRUCTURE,{fileStructure:o,openFiles:l,activeFile:c,socketId:m.socketId}),t.emit(x.SYNC_DRAWING,{drawingData:r,socketId:m.socketId}),s(g=>[...g,m])},[c,r,o,l,s,t]),ne=i.useCallback(({fileStructure:m,openFiles:g,activeFile:E})=>{a(m),u(g),p(E),I.dismiss()},[]),se=i.useCallback(({parentDirId:m,newDirectory:g})=>{h(m,g,!1)},[h]),re=i.useCallback(({dirId:m,children:g})=>{f(m,g,!1)},[f]),oe=i.useCallback(({dirId:m,newName:g})=>{v(m,g,!1)},[v]),ie=i.useCallback(({dirId:m})=>{j(m,!1)},[j]),ae=i.useCallback(({parentDirId:m,newFile:g})=>{A(m,g,!1)},[A]),le=i.useCallback(({fileId:m,newContent:g})=>{M(m,g),(c==null?void 0:c.id)===m&&p({...c,content:g})},[c,M]),ce=i.useCallback(({fileId:m,newName:g})=>{G(m,g,!1)},[G]),ue=i.useCallback(({fileId:m})=>{W(m,!1)},[W]);return i.useEffect(()=>(t.once(x.SYNC_FILE_STRUCTURE,ne),t.on(x.USER_JOINED,te),t.on(x.DIRECTORY_CREATED,se),t.on(x.DIRECTORY_UPDATED,re),t.on(x.DIRECTORY_RENAMED,oe),t.on(x.DIRECTORY_DELETED,ie),t.on(x.FILE_CREATED,ae),t.on(x.FILE_UPDATED,le),t.on(x.FILE_RENAMED,ce),t.on(x.FILE_DELETED,ue),()=>{t.off(x.USER_JOINED),t.off(x.DIRECTORY_CREATED),t.off(x.DIRECTORY_UPDATED),t.off(x.DIRECTORY_RENAMED),t.off(x.DIRECTORY_DELETED),t.off(x.FILE_CREATED),t.off(x.FILE_UPDATED),t.off(x.FILE_RENAMED),t.off(x.FILE_DELETED)}),[se,ie,oe,re,ae,ue,ce,ne,le,te,t]),n.jsx(Re.Provider,{value:{fileStructure:o,openFiles:l,activeFile:c,setActiveFile:p,closeFile:U,toggleDirectory:y,collapseDirectories:N,createDirectory:h,updateDirectory:f,renameDirectory:v,deleteDirectory:j,openFile:k,createFile:A,updateFileContent:M,renameFile:G,deleteFile:W,downloadFilesAndFolders:Me},children:e})}const ke=({ref:e})=>{const[t,s]=i.useState(!1),[r,o]=i.useState({x:0,y:0});return i.useEffect(()=>{const a=e.current;if(!a)return;const d=()=>{s(!1)},l=c=>{e.current&&e.current.contains(c.target)?(s(!0),o({x:c.pageX,y:c.pageY})):s(!1)},u=c=>{c.preventDefault(),s(!0),o({x:c.pageX,y:c.pageY})};return a.addEventListener("contextmenu",u),document.addEventListener("click",d),document.addEventListener("contextmenu",l),()=>{a.removeEventListener("contextmenu",u),document.removeEventListener("click",d),document.removeEventListener("contextmenu",l)}},[e]),{menuOpen:t,setMenuOpen:s,coords:r,setCoords:o}},Le=e=>{var r;return`vscode-icons:${(r=ut.getIconForFile(e))==null?void 0:r.replace(/_/g,"-").split(".")[0]}`};function Te({id:e,preName:t,setEditing:s,type:r}){const[o,a]=i.useState(t||""),{renameFile:d,openFile:l,renameDirectory:u}=_(),c=i.useRef(null),p=h=>{h.preventDefault(),h.stopPropagation();const f=r.charAt(0).toUpperCase()+r.slice(1);if(o==="")R.error(`${f} name cannot be empty`);else if(o.length>25)R.error(`${f} name cannot be longer than 25 characters`);else if(o===t)R.error(`${f} name cannot be the same as before`);else{const v=r==="directory"?u(e,o):d(e,o);v&&r==="file"&&l(e),v?s(!1):R.error(`${f} with same name already exists`)}},y=i.useCallback(h=>{var f;h.key==="Enter"?(f=c.current)==null||f.requestSubmit():h.key==="Escape"&&s(!1)},[s]),N=i.useCallback(h=>{const f=c.current;f&&!f.contains(h.target)&&s(!1)},[s]);return i.useEffect(()=>{const h=c.current;if(h)return h.focus(),h.addEventListener("keydown",y),document.addEventListener("keydown",N),document.addEventListener("click",N),()=>{h.removeEventListener("keydown",y),document.removeEventListener("keydown",N),document.removeEventListener("click",N)}},[N,y,s]),n.jsx("div",{className:"rounded-md",children:n.jsx("form",{onSubmit:p,ref:c,className:"flex w-full items-center gap-2 rounded-md",children:n.jsx("input",{type:"text",className:"w-full flex-grow rounded-sm bg-dark px-2 text-base text-white outline-none",autoFocus:!0,value:o,onChange:h=>a(h.target.value)})})})}function kn(){const{fileStructure:e,createFile:t,createDirectory:s,collapseDirectories:r}=_(),o=i.useRef(null),[a,d]=i.useState(null),{minHeightReached:l}=O(),u=N=>{o.current&&!o.current.contains(N.target)&&d(e.id)},c=()=>{const N=prompt("Enter file name");if(N){const h=a||e.id;t(h,N)}},p=()=>{const N=prompt("Enter directory name");if(N){const h=a||e.id;s(h,N)}},y=Ie(e);return n.jsxs("div",{onClick:u,className:"flex flex-grow flex-col",children:[n.jsxs("div",{className:"view-title flex justify-between",children:[n.jsx("h2",{children:"Files"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:c,title:"Create File",children:n.jsx(Je,{size:20})}),n.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:p,title:"Create Directory",children:n.jsx(Ve,{size:20})}),n.jsx("button",{className:"rounded-md px-1 hover:bg-darkHover",onClick:r,title:"Collapse All Directories",children:n.jsx(Be,{size:20})})]})]}),n.jsx("div",{className:Y("min-h-[200px] flex-grow overflow-auto pr-2 sm:min-h-0",{"h-[calc(80vh-170px)]":!l,"h-[85vh]":l}),ref:o,children:y.children&&y.children.map(N=>n.jsx(Oe,{item:N,setSelectedDirId:d},N.id))})]})}function Oe({item:e,setSelectedDirId:t}){const[s,r]=i.useState(!1),o=i.useRef(null),{coords:a,menuOpen:d,setMenuOpen:l}=ke({ref:o}),{deleteDirectory:u,toggleDirectory:c}=_(),p=h=>{t(h),c(h)},y=h=>{h.stopPropagation(),l(!1),r(!0)},N=(h,f)=>{h.stopPropagation(),l(!1),confirm("Are you sure you want to delete directory?")&&u(f)};return i.useEffect(()=>{const h=o.current;if(!h)return;h.tabIndex=0;const f=v=>{v.stopPropagation(),v.key==="F2"&&r(!0)};return h.addEventListener("keydown",f),()=>{h.removeEventListener("keydown",f)}},[]),e.type==="file"?n.jsx(Ln,{item:e,setSelectedDirId:t}):n.jsxs("div",{className:"overflow-x-auto",children:[n.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>p(e.id),ref:o,children:[e.isOpen?n.jsx($e,{size:24,className:"mr-2 min-w-fit"}):n.jsx(qe,{size:24,className:"mr-2 min-w-fit"}),s?n.jsx(Te,{id:e.id,preName:e.name,type:"directory",setEditing:r}):n.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:e.name,children:e.name})]}),n.jsx("div",{className:Y({hidden:!e.isOpen},{block:e.isOpen},{"pl-4":e.name!=="root"}),children:e.children&&e.children.map(h=>n.jsx(Oe,{item:h,setSelectedDirId:t},h.id))}),d&&n.jsx(On,{handleDeleteDirectory:N,handleRenameDirectory:y,id:e.id,left:a.x,top:a.y})]})}const Ln=({item:e,setSelectedDirId:t})=>{const{deleteFile:s,openFile:r}=_(),[o,a]=i.useState(!1),{setIsSidebarOpen:d}=X(),{isMobile:l}=J(),{activityState:u,setActivityState:c}=L(),p=i.useRef(null),{menuOpen:y,coords:N,setMenuOpen:h}=ke({ref:p}),f=k=>{o||(t(k),r(k),l&&d(!1),u===P.DRAWING&&c(P.CODING))},v=k=>{k.stopPropagation(),a(!0),h(!1)},j=(k,U)=>{k.stopPropagation(),h(!1),confirm("Are you sure you want to delete file?")&&s(U)};return i.useEffect(()=>{const k=p.current;if(!k)return;k.tabIndex=0;const U=A=>{A.stopPropagation(),A.key==="F2"&&a(!0)};return k.addEventListener("keydown",U),()=>{k.removeEventListener("keydown",U)}},[]),n.jsxs("div",{className:"flex w-full items-center rounded-md px-2 py-1 hover:bg-darkHover",onClick:()=>f(e.id),ref:p,children:[n.jsx(be,{icon:Le(e.name),fontSize:22,className:"mr-2 min-w-fit"}),o?n.jsx(Te,{id:e.id,preName:e.name,type:"file",setEditing:a}):n.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:e.name,children:e.name}),y&&n.jsx(Tn,{top:N.y,left:N.x,id:e.id,handleRenameFile:v,handleDeleteFile:j})]})},Tn=({top:e,left:t,id:s,handleRenameFile:r,handleDeleteFile:o})=>n.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:e,left:t},children:[n.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[n.jsx(xe,{size:18}),"Rename"]}),n.jsxs("button",{onClick:a=>o(a,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[n.jsx(we,{size:20}),"Delete"]})]}),On=({top:e,left:t,id:s,handleRenameDirectory:r,handleDeleteDirectory:o})=>n.jsxs("div",{className:"absolute z-10 w-[150px] rounded-md border border-darkHover bg-dark p-1",style:{top:e,left:t},children:[n.jsxs("button",{onClick:r,className:"flex w-full items-center gap-2 rounded-md px-2 py-1 hover:bg-darkHover",children:[n.jsx(xe,{size:18}),"Rename"]}),n.jsxs("button",{onClick:a=>o(a,s),className:"flex w-full items-center gap-2 rounded-md px-2 py-1 text-danger hover:bg-darkHover",children:[n.jsx(we,{size:20}),"Delete"]})]});function Fn(){const{downloadFilesAndFolders:e,updateDirectory:t}=_(),{viewHeight:s}=O(),{minHeightReached:r}=O(),o=async()=>{if("showDirectoryPicker"in window)try{const d=await window.showDirectoryPicker();I.loading("Getting files and folders...");const l=await a(d);t("",l)}catch(d){console.error("Error opening directory:",d)}else alert("The File System Access API is not supported in this browser.")},a=async d=>{const l=[],u=["node_modules",".git",".vscode",".next"];for await(const c of d.values())if(c.kind==="file"){const p=await c.getFile(),y={id:H(),name:c.name,type:"file",content:await p.text()};l.push(y)}else if(c.kind==="directory"){if(u.includes(c.name))continue;const p={id:H(),name:c.name,type:"directory",children:await a(c),isOpen:!1};l.push(p)}return l};return n.jsxs("div",{className:"flex select-none flex-col gap-1 px-4 py-2",style:{height:s,maxHeight:s},children:[n.jsx(kn,{}),n.jsxs("div",{className:Y("flex min-h-fit flex-col justify-end pt-2",{hidden:r}),children:[n.jsx("hr",{}),n.jsxs("button",{className:"mt-2 flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:o,children:[n.jsx(Qe,{className:"mr-2",size:24}),"Open File/Folder"]}),n.jsxs("button",{className:"flex w-full justify-start rounded-md p-2 transition-all hover:bg-darkHover",onClick:e,children:[n.jsx(Xe,{className:"mr-2",size:22})," Download Code"]})]})]})}const An="https://emkc.org/api/v2/piston",pe=dt.create({baseURL:An,headers:{"Content-Type":"application/json"}}),Fe=i.createContext(null),Pn=()=>{const e=i.useContext(Fe);if(e===null)throw new Error("useRunCode must be used within a RunCodeContextProvider");return e},_n=({children:e})=>{const{activeFile:t}=_(),[s,r]=i.useState(""),[o,a]=i.useState(""),[d,l]=i.useState(!1),[u,c]=i.useState([]),[p,y]=i.useState({language:"",version:"",aliases:[]});i.useEffect(()=>{(async()=>{var f,v;try{const j=await pe.get("/runtimes");c(j.data)}catch(j){R.error("Failed to fetch supported languages"),(f=j==null?void 0:j.response)!=null&&f.data&&console.error((v=j==null?void 0:j.response)==null?void 0:v.data)}})()},[]),i.useEffect(()=>{if(u.length===0||!(t!=null&&t.name))return;const h=t.name.split(".").pop();if(h){const f=Ce.languages(h),v=u.find(j=>j.aliases.includes(h)||f.includes(j.language.toLowerCase()));v&&y(v)}else y({language:"",version:"",aliases:[]})},[t==null?void 0:t.name,u]);const N=async()=>{try{if(p)if(t)R.loading("Running code...");else return R.error("Please open a file to run the code");else return R.error("Please select a language to run the code");l(!0);const{language:h,version:f}=p,v=await pe.post("/execute",{language:h,version:f,files:[{name:t.name,content:t.content}],stdin:s});v.data.run.stderr?a(v.data.run.stderr):a(v.data.run.stdout),l(!1),R.dismiss()}catch(h){console.error(h.response.data),console.error(h.response.data.error),l(!1),R.dismiss(),R.error("Failed to run the code")}};return n.jsx(Fe.Provider,{value:{setInput:r,output:o,isRunning:d,supportedLanguages:u,selectedLanguage:p,setSelectedLanguage:y,runCode:N},children:e})};function Un(){const{viewHeight:e}=O(),{setInput:t,output:s,isRunning:r,supportedLanguages:o,selectedLanguage:a,setSelectedLanguage:d,runCode:l}=Pn(),u=p=>{const y=JSON.parse(p.target.value);d(y)},c=()=>{navigator.clipboard.writeText(s),R.success("Output copied to clipboard")};return n.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:e},children:[n.jsx("h1",{className:"view-title",children:"Run Code"}),n.jsxs("div",{className:"flex h-[90%] w-full flex-col items-end gap-2 md:h-[92%]",children:[n.jsxs("div",{className:"relative w-full",children:[n.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:JSON.stringify(a),onChange:u,children:o.sort((p,y)=>p.language>y.language?1:-1).map((p,y)=>n.jsx("option",{value:JSON.stringify(p),children:p.language+(p.version?` (${p.version})`:"")},y))}),n.jsx(Ee,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]}),n.jsx("textarea",{className:"min-h-[120px] w-full resize-none rounded-md border-none bg-darkHover p-2 text-white outline-none",placeholder:"Write you input here...",onChange:p=>t(p.target.value)}),n.jsx("button",{className:"flex w-full justify-center rounded-md bg-primary p-2 font-bold text-black outline-none disabled:cursor-not-allowed disabled:opacity-50",onClick:l,disabled:r,children:"Run"}),n.jsxs("label",{className:"flex w-full justify-between",children:["Output :",n.jsx("button",{onClick:c,title:"Copy Output",children:n.jsx(Ne,{size:18,className:"cursor-pointer text-white"})})]}),n.jsx("div",{className:"w-full flex-grow resize-none overflow-y-auto rounded-md border-none bg-darkHover p-2 text-white outline-none",children:n.jsx("code",{children:n.jsx("pre",{className:"text-wrap",children:s})})})]})]})}function Z({onChange:e,value:t,options:s,title:r}){return n.jsxs("div",{className:"relative w-full",children:[n.jsx("label",{className:"mb-2",children:r}),n.jsx("select",{className:"w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",value:t,onChange:e,children:s.sort().map(o=>{const a=o,d=o.charAt(0).toUpperCase()+o.slice(1);return n.jsx("option",{value:a,children:d},d)})}),n.jsx(Ee,{size:16,className:"absolute bottom-3 right-4 z-10 text-white"})]})}function Ae(){return{setItem:(r,o)=>{localStorage.setItem(r,o)},getItem:r=>localStorage.getItem(r),removeItem:r=>{localStorage.removeItem(r)}}}const Pe=i.createContext(null),Q=()=>{const e=i.useContext(Pe);if(!e)throw new Error("useSettings must be used within a SettingContextProvider");return e},z={theme:"Dracula",language:"Javascript",fontSize:16,fontFamily:"Space Mono"};function Mn({children:e}){const{getItem:t}=Ae(),s=JSON.parse(t("settings")||"{}"),r=s.theme!==void 0?s.theme:z.theme,o=s.language!==void 0?s.language:z.language,a=s.fontSize!==void 0?s.fontSize:z.fontSize,d=s.fontFamily!==void 0?s.fontFamily:z.fontFamily,[l,u]=i.useState(r),[c,p]=i.useState(o),[y,N]=i.useState(a),[h,f]=i.useState(d),v=()=>{u(z.theme),p(z.language),N(z.fontSize),f(z.fontFamily)};return i.useEffect(()=>{const j={theme:l,language:c,fontSize:y,fontFamily:h};localStorage.setItem("settings",JSON.stringify(j))},[l,c,y,h]),n.jsx(Pe.Provider,{value:{theme:l,setTheme:u,language:c,setLanguage:p,fontSize:y,setFontSize:N,fontFamily:h,setFontFamily:f,resetSettings:v},children:e})}const zn=["Anonymous Pro","Cousine","Fira Code","Inconsolata","JetBrains Mono","Jura","Roboto Mono","Source Code Pro","Space Mono","Ubuntu Mono"],_e={Abcdef:en,Abyss:Zt,"Android Studio":Kt,Andromeda:Xt,"Atom One":Qt,Aura:qt,"Basic Dark":$t,"Basic Light":Bt,BBEdit:Vt,Bespin:Jt,Copilot:Yt,Darcula:Wt,Dracula:Gt,"Duotone Dark":Ht,"Duotone Light":zt,Eclipse:Mt,"GitHub Dark":Ut,"GitHub Light":_t,"Gruvbox Dark":Pt,"Gruvbox Light":At,Kimbie:Ft,Material:Ot,"Material Dark":Tt,"Material Light":Lt,Monokai:kt,"Monokai Dimmed":Rt,"Noctis Lilac":It,Nord:Dt,Okaidia:jt,"Quiet Light":St,Red:yt,"Solarized Dark":vt,"Solarized Light":Ct,Sublime:bt,"Tokyo Night":Nt,"Tokyo Night Day":Et,"Tokyo Night Storm":wt,"Tomorrow Night Blue":xt,"VS Code Dark":gt,"White Dark":ht,"White Light":pt,"Xcode Dark":ft,"Xcode Light":mt};function Hn(){const{theme:e,setTheme:t,language:s,setLanguage:r,fontSize:o,setFontSize:a,fontFamily:d,setFontFamily:l,resetSettings:u}=Q(),{viewHeight:c}=O(),p=f=>l(f.target.value),y=f=>t(f.target.value),N=f=>r(f.target.value),h=f=>a(parseInt(f.target.value));return i.useEffect(()=>{const f=document.querySelector(".cm-editor > .cm-scroller");f!==null&&(f.style.fontFamily=`${d}, monospace`)},[d]),n.jsxs("div",{className:"flex flex-col items-center gap-2 p-4",style:{height:c},children:[n.jsx("h1",{className:"view-title",children:"Settings"}),n.jsxs("div",{className:"flex w-full items-end gap-2",children:[n.jsx(Z,{onChange:p,value:d,options:zn,title:"Font Family"}),n.jsx("select",{value:o,onChange:h,className:"rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",title:"Font Size",children:[...Array(13).keys()].map(f=>n.jsx("option",{value:f+12,children:f+12},f))})]}),n.jsx(Z,{onChange:y,value:e,options:Object.keys(_e),title:"Theme"}),n.jsx(Z,{onChange:N,value:s,options:tn,title:"Language"}),n.jsx("button",{className:"mt-auto w-full rounded-md border-none bg-darkHover px-4 py-2 text-white outline-none",onClick:u,children:"Reset to default"})]})}function Gn(){const{users:e}=L();return n.jsx("div",{className:"flex min-h-[200px] flex-grow justify-center overflow-y-auto py-2",children:n.jsx("div",{className:"flex h-full w-full flex-wrap items-start gap-x-2 gap-y-6",children:e.map(t=>n.jsx(Wn,{user:t},t.socketId))})})}const Wn=({user:e})=>{const{username:t,status:s}=e,r=`${t} - ${s===$.ONLINE?"online":"offline"}`;return n.jsxs("div",{className:"relative flex w-[100px] flex-col items-center gap-2",title:r,children:[n.jsx(an,{name:t,size:"50",round:"12px",title:r}),n.jsx("p",{className:"line-clamp-2 max-w-full text-ellipsis break-words",children:t}),n.jsx("div",{className:`absolute right-5 top-0 h-3 w-3 rounded-full ${s===$.ONLINE?"bg-green-500":"bg-danger"}`})]})};function Yn(){const e=q(),{viewHeight:t}=O(),{setStatus:s}=L(),{socket:r}=F(),o=async()=>{const l=window.location.href;try{await navigator.clipboard.writeText(l),R.success("URL copied to clipboard")}catch(u){R.error("Unable to copy URL to clipboard"),console.log(u)}},a=async()=>{const l=window.location.href;try{await navigator.share({url:l})}catch(u){R.error("Unable to share URL"),console.log(u)}},d=()=>{r.disconnect(),s(T.DISCONNECTED),e("/",{replace:!0})};return n.jsxs("div",{className:"flex flex-col p-4",style:{height:t},children:[n.jsx("h1",{className:"view-title",children:"Users"}),n.jsx(Gn,{}),n.jsx("div",{className:"flex flex-col items-center gap-4 pt-4",children:n.jsxs("div",{className:"flex w-full gap-4",children:[n.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:a,title:"Share Link",children:n.jsx(Ke,{size:26})}),n.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-white p-3 text-black",onClick:o,title:"Copy Link",children:n.jsx(Ne,{size:22})}),n.jsx("button",{className:"flex flex-grow items-center justify-center rounded-md bg-primary p-3 text-black",onClick:d,title:"Leave room",children:n.jsx(Ze,{size:22})})]})})]})}var D=(e=>(e.FILES="FILES",e.CHATS="CHATS",e.CLIENTS="CLIENTS",e.RUN="RUN",e.SETTINGS="SETTINGS",e))(D||{});const Ue=i.createContext(null),X=()=>{const e=i.useContext(Ue);if(!e)throw new Error("useViews must be used within a ViewContextProvider");return e};function Jn({children:e}){const{isMobile:t}=J(),[s,r]=i.useState(D.FILES),[o,a]=i.useState(!t),[d]=i.useState({[D.FILES]:n.jsx(Fn,{}),[D.CLIENTS]:n.jsx(Yn,{}),[D.SETTINGS]:n.jsx(Hn,{}),[D.CHATS]:n.jsx(Sn,{}),[D.RUN]:n.jsx(Un,{})}),[l]=i.useState({[D.FILES]:n.jsx(rt,{size:28}),[D.CLIENTS]:n.jsx(st,{size:30}),[D.SETTINGS]:n.jsx(nt,{size:28}),[D.CHATS]:n.jsx(tt,{size:30}),[D.RUN]:n.jsx(et,{size:28})});return n.jsx(Ue.Provider,{value:{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:a,viewComponents:d,viewIcons:l},children:e})}function Vn({children:e}){const{isSidebarOpen:t}=X(),{isMobile:s,width:r}=J(),{setItem:o,getItem:a}=Ae(),d=()=>{const N=document.createElement("div");return N.className="h-full cursor-e-resizer hidden md:block",N.style.backgroundColor="#e1e1ffb3",N},l=()=>{if(s)return[0,r];const N=a("editorSizes");let h=[35,65];return N&&(h=JSON.parse(N)),t?h:[0,r]},u=()=>s?[0,r]:t?[350,350]:[50,0],c=()=>s?[0,1/0]:t?[1/0,1/0]:[0,1/0],p=N=>{o("editorSizes",JSON.stringify(N))},y=()=>({width:"7px",display:t&&!s?"block":"none"});return n.jsx(un,{sizes:l(),minSize:u(),gutter:d,maxSize:c(),dragInterval:1,direction:"horizontal",gutterAlign:"center",cursor:"e-resize",snapOffset:30,gutterStyle:y,onDrag:p,className:"flex h-screen min-h-screen max-w-full items-center justify-center overflow-hidden",children:e})}function Bn(){return n.jsx("div",{className:"flex h-screen min-h-screen flex-col items-center justify-center gap-6 px-4 text-center",children:n.jsx($n,{})})}const $n=()=>{const e=q(),t=()=>{window.location.reload()},s=()=>{e("/")};return n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"whitespace-break-spaces text-lg font-medium text-slate-300",children:"Oops! Something went wrong. Please try again"}),n.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[n.jsx("button",{className:"mr-4 rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:t,children:"Try Again"}),n.jsx("button",{className:"rounded-md bg-primary px-8 py-2 font-bold text-black",onClick:s,children:"Go to HomePage"})]})]})},B=({viewName:e,icon:t})=>{const{activeView:s,setActiveView:r,isSidebarOpen:o,setIsSidebarOpen:a}=X(),{isNewMessage:d}=ee(),l=u=>{u===s?a(!o):(a(!0),r(u))};return n.jsxs("button",{onClick:()=>l(e),className:"relative flex items-center justify-center",children:[t,e===D.CHATS&&d&&n.jsx("div",{className:"absolute right-0 top-0 h-3 w-3 rounded-full bg-primary"})]})};function qn(){const{activeView:e,isSidebarOpen:t,viewComponents:s,viewIcons:r,setIsSidebarOpen:o}=X(),{minHeightReached:a}=O(),{activityState:d,setActivityState:l}=L(),{socket:u}=F(),{isMobile:c}=J(),p=()=>{d===P.CODING?(l(P.DRAWING),u.emit(x.REQUEST_DRAWING)):l(P.CODING),c&&o(!1)};return n.jsxs("aside",{className:"flex w-full md:h-full md:max-h-full md:min-h-full md:w-auto",children:[n.jsxs("div",{className:Y("fixed bottom-0 left-0 z-50 flex h-[50px] w-full gap-6 self-end overflow-auto border-t border-darkHover bg-dark p-3 md:static md:h-full md:w-[50px] md:min-w-[50px] md:flex-col md:border-r md:border-t-0 md:p-2 md:pt-4",{hidden:a}),children:[n.jsx(B,{viewName:D.FILES,icon:r[D.FILES]}),n.jsx(B,{viewName:D.CHATS,icon:r[D.CHATS]}),n.jsx(B,{viewName:D.RUN,icon:r[D.RUN]}),n.jsx(B,{viewName:D.CLIENTS,icon:r[D.CLIENTS]}),n.jsx(B,{viewName:D.SETTINGS,icon:r[D.SETTINGS]}),n.jsx("button",{className:"self-end",onClick:p,children:d===P.CODING?n.jsx(ot,{size:30}):n.jsx(it,{size:30})})]}),n.jsx("div",{className:"absolute left-0 top-0 z-20 w-full flex-grow flex-col bg-dark md:static md:w-[300px]",style:t?{}:{display:"none"},children:s[e]})]})}function Qn(){const{isMobile:e}=J();return n.jsx(mn,{inferDarkMode:!0,forceMobile:e,defaultName:"Editor",className:"z-0",children:n.jsx(Xn,{})})}function Xn(){const e=dn(),{drawingData:t,setDrawingData:s}=L(),{socket:r}=F(),o=i.useCallback(d=>{const l=d.changes;s(e.store.getSnapshot()),r.emit(x.DRAWING_UPDATE,{snapshot:l})},[e.store,s,r]),a=i.useCallback(({snapshot:d})=>{e.store.mergeRemoteChanges(()=>{const{added:l,updated:u,removed:c}=d;for(const p of Object.values(l))e.store.put([p]);for(const[,p]of Object.values(u))e.store.put([p]);for(const p of Object.values(c))e.store.remove([p.id])}),s(e.store.getSnapshot())},[e.store,s]);return i.useEffect(()=>{t&&Object.keys(t).length>0&&e.store.loadSnapshot(t)},[]),i.useEffect(()=>{const d=e.store.listen(o,{source:"user",scope:"document"});return r.on(x.DRAWING_UPDATE,a),()=>{d(),r.off(x.DRAWING_UPDATE)}},[t,e.store,o,a,r]),null}function Kn(){const{fontSize:e,setFontSize:t}=Q();i.useEffect(()=>{const s=r=>{const o="Changes you made may not be saved";return r.returnValue=o};return window.addEventListener("beforeunload",s),()=>{window.removeEventListener("beforeunload",s)}},[]),i.useEffect(()=>{const s=r=>{if(r.ctrlKey){if(r.preventDefault(),!r.target.closest(".cm-editor"))return;r.deltaY>0?t(Math.max(e-1,12)):t(Math.min(e+1,24))}};return window.addEventListener("wheel",s,{passive:!1}),()=>{window.removeEventListener("wheel",s)}},[e,t])}function Zn(e){return pn.define({create:()=>he(e),update(t,s){return!s.docChanged&&!s.selection?t:he(e)},provide:t=>hn.computeN([t],s=>s.field(t))})}function he(e){return e.map(t=>{if(!t.typing)return null;let s=t.username;const r=t.cursorPosition;return t&&(s=t.username),{pos:r,above:!0,strictSide:!0,arrow:!0,create:()=>{const o=document.createElement("div");return o.className="cm-tooltip-cursor",o.textContent=s,{dom:o}}}})}const es=fn.baseTheme({".cm-tooltip.cm-tooltip-cursor":{backgroundColor:"#66b",color:"white",border:"none",padding:"2px 7px",borderRadius:"4px",zIndex:"10","& .cm-tooltip-arrow:before":{borderTopColor:"#66b"},"& .cm-tooltip-arrow:after":{borderTopColor:"transparent"}}});function ts(){const{users:e,currentUser:t}=L(),{activeFile:s,setActiveFile:r}=_(),{theme:o,language:a,fontSize:d}=Q(),{socket:l}=F(),{viewHeight:u}=O(),[c,p]=i.useState(setTimeout(()=>{},0)),y=i.useMemo(()=>e.filter(v=>v.username!==t.username),[e,t]),[N,h]=i.useState([]),f=(v,j)=>{var M,G,W;if(!s)return;const k={...s,content:v};r(k);const U=(W=(G=(M=j.state)==null?void 0:M.selection)==null?void 0:G.main)==null?void 0:W.head;l.emit(x.TYPING_START,{cursorPosition:U}),l.emit(x.FILE_UPDATED,{fileId:s.id,newContent:v}),clearTimeout(c);const A=setTimeout(()=>l.emit(x.TYPING_PAUSE),1e3);p(A)};return Kn(),i.useEffect(()=>{const v=[nn,sn,Zn(y),es,gn()],j=rn(a.toLowerCase());j?v.push(j):R.error("Syntax highlighting is unavailable for this language. Please adjust the editor settings; it may be listed under a different name.",{duration:5e3}),h(v)},[y,a]),n.jsx(on,{theme:_e[o],onChange:f,value:s==null?void 0:s.content,extensions:N,minHeight:"100%",maxWidth:"100vw",style:{fontSize:d+"px",height:u,position:"relative"}})}const ge={php:"php",cs:"csharp"};function ns(){const{openFiles:e,closeFile:t,activeFile:s,updateFileContent:r,setActiveFile:o}=_(),a=i.useRef(null),{setLanguage:d}=Q(),l=u=>{if((s==null?void 0:s.id)===u)return;r((s==null?void 0:s.id)||"",(s==null?void 0:s.content)||"");const c=e.find(p=>p.id===u);c&&o(c)};return i.useEffect(()=>{const u=a.current;if(!u)return;const c=p=>{p.deltaY>0?u.scrollLeft+=100:u.scrollLeft-=100};return u.addEventListener("wheel",c),()=>{u.removeEventListener("wheel",c)}},[]),i.useEffect(()=>{if((s==null?void 0:s.name)===void 0)return;const u=s.name.split(".").pop();if(!u)return;if(ge[u]){d(ge[u]);return}const c=Ce.languages(u);d(c[0])},[s==null?void 0:s.name,d]),n.jsx("div",{className:"flex h-[50px] w-full select-none gap-2 overflow-x-auto p-2 pb-0",ref:a,children:e.map(u=>n.jsxs("span",{className:Y("flex w-fit cursor-pointer items-center rounded-t-md px-2 py-1 text-white",{"bg-darkHover":u.id===(s==null?void 0:s.id)}),onClick:()=>l(u.id),children:[n.jsx(be,{icon:Le(u.name),fontSize:22,className:"mr-2 min-w-fit"}),n.jsx("p",{className:"flex-grow cursor-pointer overflow-hidden truncate",title:u.name,children:u.name}),n.jsx(at,{className:"ml-3 inline rounded-md hover:bg-darkHover",size:20,onClick:()=>t(u.id)})]},u.id))})}function ss(){const{openFiles:e}=_(),{minHeightReached:t}=O();return e.length<=0?n.jsx("div",{className:"flex h-full w-full items-center justify-center",children:n.jsx("h1",{className:"text-xl text-white",children:"No file is currently open."})}):n.jsxs("main",{className:Y("flex w-full flex-col overflow-x-auto md:h-screen",{"h-[calc(100vh-50px)]":!t,"h-full":t}),children:[n.jsx(ns,{}),n.jsx(ts,{})]})}function rs(){const{viewHeight:e}=O(),{activityState:t}=L();return n.jsx("div",{className:"absolute left-0 top-0 w-full max-w-full flex-grow overflow-x-hidden md:static",style:{height:e},children:t===P.DRAWING?n.jsx(Qn,{}):n.jsx(ss,{})})}function os(){function e(){return[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(r=>navigator.userAgent.match(r))}const t=e();i.useEffect(()=>{t&&me.isEnabled&&me.request()},[t])}function is(){const{setUsers:e}=L(),{socket:t}=F(),s=i.useCallback(()=>{document.visibilityState==="visible"?t.emit(x.USER_ONLINE,{socketId:t.id}):document.visibilityState==="hidden"&&t.emit(x.USER_OFFLINE,{socketId:t.id})},[t]),r=i.useCallback(({socketId:d})=>{e(l=>l.map(u=>u.socketId===d?{...u,status:$.ONLINE}:u))},[e]),o=i.useCallback(({socketId:d})=>{e(l=>l.map(u=>u.socketId===d?{...u,status:$.OFFLINE}:u))},[e]),a=i.useCallback(({user:d})=>{e(l=>l.map(u=>u.socketId===d.socketId?d:u))},[e]);i.useEffect(()=>(document.addEventListener("visibilitychange",s),t.on(x.USER_ONLINE,r),t.on(x.USER_OFFLINE,o),t.on(x.TYPING_START,a),t.on(x.TYPING_PAUSE,a),()=>{document.removeEventListener("visibilitychange",s),t.off(x.USER_ONLINE),t.off(x.USER_OFFLINE),t.off(x.TYPING_START),t.off(x.TYPING_PAUSE)}),[t,e,s,r,o,a])}function as(){var l;is(),os();const e=q(),{roomId:t}=ln(),{status:s,setCurrentUser:r,currentUser:o}=L(),{socket:a}=F(),d=ve();return i.useEffect(()=>{var c;if(o.username.length>0)return;const u=(c=d.state)==null?void 0:c.username;if(u===void 0)e("/",{state:{roomId:t}});else if(t){const p={username:u,roomId:t};r(p),a.emit(x.JOIN_REQUEST,p)}},[o.username,(l=d.state)==null?void 0:l.username,e,t,r,a]),s===T.CONNECTION_FAILED?n.jsx(Bn,{}):n.jsxs(Vn,{children:[n.jsx(qn,{}),n.jsx(rs,{})]})}const ls=""+new URL("illustration-DWhDKHP_.svg",import.meta.url).href,cs=""+new URL("logo-DDN_0QZb.svg",import.meta.url).href,us=()=>{var N,h;const e=ve(),{currentUser:t,setCurrentUser:s,status:r,setStatus:o}=L(),{socket:a}=F(),d=i.useRef(null),l=q(),u=()=>{var f;s({...t,roomId:H()}),I.success("Created a new Room Id"),(f=d.current)==null||f.focus()},c=f=>{const v=f.target.name,j=f.target.value;s({...t,[v]:j})},p=()=>t.username.length===0?(I.error("Enter your username"),!1):t.roomId.length===0?(I.error("Enter a room id"),!1):t.roomId.length<5?(I.error("ROOM Id must be at least 5 characters long"),!1):t.username.length<3?(I.error("Username must be at least 3 characters long"),!1):!0,y=f=>{f.preventDefault(),r!==T.ATTEMPTING_JOIN&&p()&&(I.loading("Joining room..."),o(T.ATTEMPTING_JOIN),a.emit(x.JOIN_REQUEST,t))};return i.useEffect(()=>{var f;t.roomId.length>0||(f=e.state)!=null&&f.roomId&&(s({...t,roomId:e.state.roomId}),t.username.length===0&&I.success("Enter your username"))},[t,(N=e.state)==null?void 0:N.roomId,s]),i.useEffect(()=>{if(r===T.DISCONNECTED&&!a.connected){a.connect();return}const f=sessionStorage.getItem("redirect")||!1;if(r===T.JOINED&&!f){const v=t.username;sessionStorage.setItem("redirect","true"),l(`/editor/${t.roomId}`,{state:{username:v}})}else r===T.JOINED&&f&&(sessionStorage.removeItem("redirect"),o(T.DISCONNECTED),a.disconnect(),a.connect())},[t,(h=e.state)==null?void 0:h.redirect,l,o,a,r]),n.jsxs("div",{className:"flex w-full max-w-[500px] flex-col items-center justify-center gap-4 p-4 sm:w-[500px] sm:p-8",children:[n.jsx("img",{src:cs,alt:"Logo",className:"w-full"}),n.jsxs("form",{onSubmit:y,className:"flex w-full flex-col gap-4",children:[n.jsx("input",{type:"text",name:"roomId",placeholder:"Room Id",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:c,value:t.roomId}),n.jsx("input",{type:"text",name:"username",placeholder:"Username",className:"w-full rounded-md border border-gray-500 bg-darkHover px-3 py-3 focus:outline-none",onChange:c,value:t.username,ref:d}),n.jsx("button",{type:"submit",className:"mt-2 w-full rounded-md bg-primary px-8 py-3 text-lg font-semibold text-black",children:"Join"})]}),n.jsx("button",{className:"cursor-pointer select-none underline",onClick:u,children:"Generate Unique Room Id"})]})};function ds(){return n.jsx("div",{className:"flex min-h-screen flex-col items-center justify-center gap-16",children:n.jsxs("div",{className:"my-12 flex h-full min-w-full flex-col items-center justify-evenly sm:flex-row sm:pt-0",children:[n.jsx("div",{className:"flex w-full animate-up-down justify-center sm:w-1/2 sm:pl-4",children:n.jsx("img",{src:ls,alt:"Code Jam Illustration",className:"mx-auto w-[250px] sm:w-[400px]"})}),n.jsx("div",{className:"flex w-full items-center justify-center sm:w-1/2",children:n.jsx(us,{})})]})})}const ms=()=>(i.useEffect(()=>{const e=document.createElement("script");return e.src="https://www.chatbase.co/embed.min.js",e.defer=!0,e.setAttribute("chatbotId","qnladmNzh53489A3MRfxR"),e.setAttribute("domain","www.chatbase.co"),document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]),n.jsxs(n.Fragment,{children:[n.jsx(He,{children:n.jsxs(cn,{children:[n.jsx(de,{path:"/",element:n.jsx(ds,{})}),n.jsx(de,{path:"/editor/:roomId",element:n.jsx(as,{})})]})}),n.jsx(xn,{})," "]}));function fs({children:e}){return n.jsx(wn,{children:n.jsx(Nn,{children:n.jsx(Mn,{children:n.jsx(Jn,{children:n.jsx(Rn,{children:n.jsx(_n,{children:n.jsx(bn,{children:e})})})})})})})}ze.createRoot(document.getElementById("root")).render(n.jsx(fs,{children:n.jsx(ms,{})}));
